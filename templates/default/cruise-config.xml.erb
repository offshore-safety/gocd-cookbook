<?xml version="1.0" encoding="utf-8"?>
<cruise xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="cruise-config.xsd" schemaVersion="75">
  <server artifactsdir="artifacts" 
          commandRepositoryLocation="default"
          agentAutoRegisterKey="<%= node[:gocd][:autoregister][:key] %>">
    <security>
      <% if node[:gocd][:ldap][:host] %>
        <ldap 
          uri="<%= node[:gocd][:ldap][:protocol] %>://<%= node[:gocd][:ldap][:host] %>:<%= node[:gocd][:ldap][:port] %>" 
          managerDn="<%= node[:gocd][:ldap][:bind_dn] %>" 
          managerPassword="<%= node[:gocd][:ldap][:bind_pass] %>" 
          searchFilter="(<%= node[:gocd][:ldap][:search_filter] %>={0})">
          <bases>
            <base value="<%= node[:gocd][:ldap][:base] %>" />
          </bases>
        </ldap>
      <% end %>
    </security>
  </server>
</cruise>